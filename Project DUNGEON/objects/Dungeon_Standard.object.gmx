<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>&lt;undefined&gt;</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>Dungeon</parentName>
  <maskName>&lt;undefined&gt;</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{
//The dungeon object holds the data for the current dungeon, including room layout, boss data, and loot
game_over = false;
//Init flag will set the dungeon to be initialized next step, after parameters are determined
init = true;
trap_animate = false;
draw_test = false;
draw_test_y = 0;
color = c_white;
boss_death_timer = 0;
enemy_level = 0;
last_was_trap = false;
chests_opened = 0;
path_list = ds_list_create();
trap_index = 0;
holy_blessing = 0;
done_ani = false;
shop_ball_timer = 0;
music_playing = false;
slime_prayed = false;
//Item variables
has_scouter = false;
has_sash = false;
in_prayer = false;
prayer_timer = 0;
prayed = false;
prayer_type = 0;
spec_alpha = 1.0;
spec_enter = false;
//Parameters
randomize();
spec_x = 128;
spec_y = 10;
spec_scale = 1;
//Width of the dungeon grid
width = irandom_range(3,3);
//Length of the dungeon grid
length = 31;
//Block size of difficulty spikes
interval = 1;
//Generation probability variables;
monster_chance_standard = 50;
bomb_chance_standard = 10;
slot_chance_standard = 10;
shop_chance_standard = 10;
heal_chance_standard = 5;
chest_chance_standard = 15;


monster_chance_treasury = 0;
chest_chance_treasury = 55;
heal_chance_treasury = 5;
shop_chance_treasury = 10;
bomb_chance_treasury = 5;
slot_chance_treasury = 25;


monster_chance_chaos = 40;
chest_chance_chaos = 10;
heal_chance_chaos = 5;
shop_chance_chaos = 25;
bomb_chance_chaos = 10;
slot_chance_chaos = 10;
hermit_index = 0;

enemy_shield = false;

special_timer = 0;
//Current battle state of the dungeon. If set, in the middle of battle. If not set, transitioning to next room
battling = false;
heal_timer = -1;
//Current phase of any battling
battle_phase = "choose";
player_dead = false;
in_trap = false;
in_shop = false;
in_chest = false;
chest_opened = false;
animate_chest = false;
timer = 0;
chest_stat = 0;
chest_value = 0;
is_mimic = false;
current_trap_spr = basic_trap_spr;
chest_index = 0;
//Use two lists to keep track of game history
foe_history = ds_list_create();
result_history = ds_list_create();


in_slot = false;
boss_theme = boss_song;


//Bomb event variables
in_bomb = false;
animate_bomb = false;
bomb_index = 0;
bomb_level = 0;
bomb_timer = 0;
bomb_strikes = 0;
bomb_code[0] = 0;
bomb_code[1] = 0;
bomb_code[2] = 0;
bomb_code[3] = 0;
bomb_wait = false;
bomb_entered[0] = false;
bomb_entered[1] = false;
bomb_entered[2] = false;
bomb_entered[3] = false;


heal_draw_y = 10;
heal_draw_index = 0;
heal_draw_alpha = 1.0;

//Determine the floor types
//type - Type of difficulty curve (Standard, Chaos, Hell, Treasury)
//curve - slope of difficuly curve
var has_treasury = false;
var has_standard = false;
var has_chaos = false;

//Allow a 3% chance for the dungeon to start in the alternate paths
var new_start = irandom_range(1,100);


floor_type[0] = "";
floor_type[1] = "";
floor_type[2] = "";

if(new_start == 110){
    floor_type[0] = "treasury";
    has_treasury = true;
    theme_music = dungeon_theme_treasury;
}
else if(new_start == 130){
    floor_type[0] = "chaos";
    has_chaos = true;
    theme_music = dungeon_theme_chaos;
}
else{
    floor_type[0] = "standard";
    has_standard = true;
    theme_music = dungeon_theme;
}

//theme_music = boss_song;

//Difficulty Curve
//
// 1 - Easy: Will spawn enemies in current tier and one below
// 
// 2 - Normal : Only Spawn enemies in current tier
// 
// 3 - Hard : Spawn enemies in current tier and one above
//
// Tier is determined by current location
//
// 1-3 : Tier 1
// 4-6 : Tier 2
// 7-9 : Tier 3
// ...
// 28-29 : Tier 9

curve = irandom_range(1,3);

var floor_n = 1;

while((has_chaos == false) or (has_standard == false) or (has_treasury == false)){
    
    if(floor_type[floor_n] == ""){
        var new_ftype = irandom_range(1,3);
    
        if(new_ftype == 1){
            if(has_standard == false){
                has_standard = true;
                floor_type[floor_n] = "standard";
            }            
        }
        else if(new_ftype == 3){
            if(has_treasury == false){
                has_treasury = true;
                floor_type[floor_n] = "treasury";
            }            
        }
        else if(new_ftype == 2){
            if(has_chaos == false){
                has_chaos = true;
                floor_type[floor_n] = "chaos";
            }            
        }    
    }
    
    floor_n += 1;
    if(floor_n == 3){floor_n = 1;}
    
}
if(!audio_is_playing(theme_music)){
    audio_sound_gain(theme_music,global.volume,0);
    audio_play_sound(theme_music,1,true);
    audio_master_gain(global.volume);
    if(Dungeon.theme_music == dungeon_theme){
                audio_sound_gain(dungeon_theme,global.volume/3.0,0);
    }
}


//Shop Variables
//
//Type - Determines the action taken by shop
// ex. reverse - Switch the values in the two shop stat variables
//     absorb  - Depending on player action, take all points in one stat and put them into the other
shop_type = "";
shop_stat_1 = "";
shop_stat_2 = "";
absorb_dir = 0;
animate_shop = false;

s1x = -4;
s1y = 12;
s2x = 56;
s2y = 12;

//Battler variables
//Holds the objects in combat
player_1 = 0;
player_2 = 0;

timer = 0;

//Trap Variables
trap_type = "";
trap_level = 0;


//Test
player_1 = instance_create(0,0,Unit);

player_1.name = "The Player";

//assign the correct class

Init_Classes();



if(player_1.attack_type == "physical"){var noff = player_1.strength;}
else{var noff = player_1.magic;}

var ndef = player_1.defense;
var nres = player_1.res;
var tdeff = round((ndef+nres)/2);

player_1.level = round((noff+tdeff)/2);


    

//Location of player
current_x = 0;
current_y = 0;

Create_Beastiary();





}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="2">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{

if(animate_shop == true){
    
    if(done_ani == false){
    
    if(timer == 0){
        hermit_timer += 1;
        if(shop_type == "reverse"){
            s1x += 4;
            s2x -= 4;
            if(spec_x + s2x &lt;= spec_x-4){timer = 1;}    
        }
        else if(shop_type == "absorb"){
            if(absorb_dir == 1){
                s2x -= 4;
                if(hermit_timer == 3){
                    hermit_index = 3;
                }
                else if(hermit_timer == 6){
                    hermit_index = 4;
                }
                if(spec_x + s2x &lt;= spec_x-2){s2x = 30000;timer = 1;}
            }
            else if(absorb_dir == 2){
                s1x += 4;
                if(hermit_timer == 3){
                    hermit_index = 1;
                }
                else if(hermit_timer == 6){
                    hermit_index = 2;
                }
                if(spec_x + s1x &gt;= spec_x + 58){s1x = 30000;timer = 1;hermit_timer = 0;}
            }    
        }   
    }
    
    else{
        if(shop_type == "reverse"){
            timer += 1;
            if(timer == 5){done_ani = true;}    
        }
        else if(shop_type == "absorb"){
            timer += 1;
            if(timer == 5){done_ani = true;}
        }        
    }
    
    }
    
    
    if(done_ani == true){
    
    spec_alpha -= 0.05;
    
    if(spec_alpha &lt; 0){
    
    
    
    animate_shop = false;
    in_shop = false;
    current_y += 1;
    timer = 0;
    s1y = 12;
    s2y = 12;
    s1x = -4;
    s2x = 56;
    
    //Apply the shop effect
    if(shop_type == "reverse"){
        if((shop_stat_1 == "STR" and shop_stat_2 == "MAG") or (shop_stat_1 == "MAG" and shop_stat_2 == "STR")){
            var swap = player_1.strength;
            player_1.strength = player_1.magic;
            player_1.magic = swap;
        }
        else if((shop_stat_1 == "STR" and shop_stat_2 == "DEF") or (shop_stat_1 == "DEF" and shop_stat_2 == "STR")){
            var swap = player_1.strength;
            player_1.strength = player_1.defense;
            player_1.defense = swap;
        }
        else if((shop_stat_1 == "STR" and shop_stat_2 == "RES") or (shop_stat_1 == "RES" and shop_stat_2 == "STR")){
            var swap = player_1.strength;
            player_1.strength = player_1.res;
            player_1.res = swap;
        }
        else if((shop_stat_1 == "STR" and shop_stat_2 == "LCK") or (shop_stat_1 == "LCK" and shop_stat_2 == "STR")){
            var swap = player_1.strength;
            player_1.strength = player_1.luck;
            player_1.luck = swap;
        }
        else if((shop_stat_1 == "MAG" and shop_stat_2 == "DEF") or (shop_stat_1 == "DEF" and shop_stat_2 == "MAG")){
            var swap = player_1.magic;
            player_1.magic = player_1.defense;
            player_1.defense = swap;
        }
        else if((shop_stat_1 == "MAG" and shop_stat_2 == "RES") or (shop_stat_1 == "RES" and shop_stat_2 == "MAG")){
            var swap = player_1.magic;
            player_1.magic = player_1.res;
            player_1.res = swap;
        }
        else if((shop_stat_1 == "MAG" and shop_stat_2 == "LCK") or (shop_stat_1 == "LCK" and shop_stat_2 == "MAG")){
            var swap = player_1.magic;
            player_1.magic = player_1.luck;
            player_1.luck = swap;
        }
        else if((shop_stat_1 == "DEF" and shop_stat_2 == "RES") or (shop_stat_1 == "RES" and shop_stat_2 == "DEF")){
            var swap = player_1.defense;
            player_1.defense = player_1.res;
            player_1.res = swap;
        }
        else if((shop_stat_1 == "DEF" and shop_stat_2 == "LCK") or (shop_stat_1 == "LCK" and shop_stat_2 == "DEF")){
            var swap = player_1.defense;
            player_1.defense = player_1.luck;
            player_1.luck = swap;
        }
        else if((shop_stat_1 == "RES" and shop_stat_2 == "LCK") or (shop_stat_1 == "LCK" and shop_stat_2 == "RES")){
            var swap = player_1.res;
            player_1.res = player_1.luck;
            player_1.luck = swap;
        }  
        //Send Message to Text Box
        Text_Box.new_text = (shop_stat_1 + " and " + shop_stat_2 + " reversed!");
        Update_Text();          
    }
    
    else if(shop_type == "absorb"){
        if(absorb_dir == 1){
            if(shop_stat_2 == "STR")     {var absorbed = player_1.strength;player_1.strength = 0;}
            else if(shop_stat_2 == "MAG"){var absorbed = player_1.magic;player_1.magic = 0;}
            else if(shop_stat_2 == "DEF"){var absorbed = player_1.defense;player_1.defense = 0;}
            else                         {var absorbed = player_1.res;player_1.res = 0;}
            
            absorbed = ceil(absorbed/4);
            
            if(shop_stat_1 = "STR")     {player_1.strength += absorbed;}
            else if(shop_stat_1 = "MAG"){player_1.magic += absorbed;}
            else if(shop_stat_1 = "DEF"){player_1.defense += absorbed;}
            else                        {player_1.res += absorbed;}
            
            Text_Box.new_text = (shop_stat_2 + " absorbed into " + shop_stat_1 + "!");
            Update_Text();
        }
        
        else if(absorb_dir == 2){
            if(shop_stat_1 == "STR")     {var absorbed = player_1.strength;player_1.strength = 0;}
            else if(shop_stat_1 == "MAG"){var absorbed = player_1.magic;player_1.magic = 0;}
            else if(shop_stat_1 == "DEF"){var absorbed = player_1.defense;player_1.defense = 0;}
            else                         {var absorbed = player_1.res;player_1.res = 0;}
            
            absorbed = ceil(absorbed/4);
            
            if(shop_stat_2 = "STR")     {player_1.strength += absorbed;}
            else if(shop_stat_2 = "MAG"){player_1.magic += absorbed;}
            else if(shop_stat_2 = "DEF"){player_1.defense += absorbed;}
            else                        {player_1.res += absorbed;}
            
            Text_Box.new_text = (shop_stat_1 + " absorbed into " + shop_stat_2 + "!");
            Update_Text();
        }    
    }
    
    }
    
    
    }
    
}

}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if(spec_enter == true){
    spec_y += 7;
    if(spec_y == 10){
        spec_enter = false;
    }
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{
if(in_shop == true and spec_enter == false and done_ani == false){
    shop_ball_timer += 1;
    if(shop_ball_timer == 1){
        s1y = 11;
        s2y = 11;
    }
    else if(shop_ball_timer == 2){
        s1y -= 1;
        s2y -= 1;
    }
    else if(shop_ball_timer == 3){
        s1y -= 1;
        s2y -= 1;
    }
    else if(shop_ball_timer == 5){
        s1y -= 1;
        s2y -= 1;
    }
    else if(shop_ball_timer == 7){
        s1y -= 1;
        s2y -= 1;
    }
    else if(shop_ball_timer == 10){
        s1y -= 1;
        s2y -= 1;
    }
    else if(shop_ball_timer == 13){
        s1y += 1;
        s2y += 1;
    }
    else if(shop_ball_timer == 15){
        s1y += 1;
        s2y += 1;
    }
    else if(shop_ball_timer == 17){
        s1y += 1;
        s2y += 1;
    }
    else if(shop_ball_timer == 18){
        s1y += 1;
        s2y += 1;
    }
    else if(shop_ball_timer == 19){
        s1y += 1;
        s2y += 1;
    }
    //////////////////////////////
    //Equilibrium
    else if(shop_ball_timer == 20){
        s1y += 1;
        s2y += 1;
    }
    //////////////////////////////
    else if(shop_ball_timer == 21){
        s1y += 1;
        s2y += 1;
    }
    else if(shop_ball_timer == 22){
        s1y += 1;
        s2y += 1;
    }
    else if(shop_ball_timer == 22){
        s1y += 1;
        s2y += 1;
    }
    else if(shop_ball_timer == 24){
        s1y += 1;
        s2y += 1;
    }
    else if(shop_ball_timer == 26){
        s1y -= 1;
        s2y -= 1;
    }
    else if(shop_ball_timer == 28){
        s1y -= 1;
        s2y -= 1;
    }
    else if(shop_ball_timer == 29){
        s1y -= 1;
        s2y -= 1;
    }
    else if(shop_ball_timer == 30){
        s1y -= 2;
        s2y -= 2;
        shop_ball_timer = 0;
    }
    
}
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>if(trap_animate == true){
    if(trap_door == "standard"){
        var start_index = 0;
        var end_index = 20;
    }
    else if(trap_door == "treasury"){
        var start_index = 21;
        var end_index = 41;
    }
    else if(trap_door == "chaos"){
        var start_index = 42;
        var end_index = 62;
    }
    
    if(trap_index &lt; end_index){trap_index += 1;}
    
    if(trap_index == end_index and !instance_exists(background_transition)){
            new_transition = instance_create(0,0,background_transition);
            if(Dungeon.trap_door == "standard")     {new_transition.sprite_index = standard_bkgd_spr;}
            else if(Dungeon.trap_door == "treasury"){new_transition.sprite_index = treasury_bkgd_spr;}
            else if(Dungeon.trap_door == "chaos"){new_transition.sprite_index = chaos_bkgd_spr;}
            else if(Dungeon.trap_door == "hell"){new_transition.sprite_index = hell_bkgd_spr;}
        
    }
    
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="1">
      <action>
        <libid>1</libid>
        <id>605</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>0</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>Generate Dungeon</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{

//Once parameters are determined, generate the dungeon
if(init == true){
    init = false;
    
    //Create the grid that will hold the layout
    map = ds_grid_create(width,length);
    
    //Values to be inserted to the grid
    //----------------------------------
    // 0 - Empty
    // 1 - Start Point
    // 2 - Monster
    // 3 - Chest 
    // 4 - Heal Zone
    // 5 - Trap
    // 6 - Shop
    // 7 - Bomb 
    // 8 - Slot
    // 9 - Boss
    // 10 - Prayer Statue
    
    //Generate dungeons until a valid one is created
    var valid = false;
    while(valid == false){
        //Make sure dungeon is empty
        var l = 0;
        var w = 0;
        while(l &lt; length){
            while(w &lt; width){
                ds_grid_set(map,w,l,0);
                w += 1;
            }
            w = 0;
            l += 1;
        }
        
        //Set starting point
        ds_grid_set(map,0,0,1);
        
        //Generate the dungeon one row at a time
        
        //Number of alternate paths at any current point in the dungeon
        var l = 1;
        while(l &lt; length-1){
            //Generate possibilities for the entire row
            var w = 0;
            while(w &lt; width){
            
                if(floor_type[w] == "standard"){
                    var hc = heal_chance_standard;
                    var mc = monster_chance_standard;
                    var wc = shop_chance_standard;
                    var bc = bomb_chance_standard;
                    var sc = slot_chance_standard;
                    var cc = chest_chance_standard;
                }
                else if(floor_type[w] == "treasury"){
                    var hc = heal_chance_treasury;
                    var mc = monster_chance_treasury;
                    var wc = shop_chance_treasury;
                    var bc = bomb_chance_treasury;
                    var sc = slot_chance_treasury;
                    var cc = chest_chance_treasury;
                }
                else if(floor_type[w] == "chaos"){
                    var hc = heal_chance_chaos;
                    var mc = monster_chance_chaos;
                    var wc = shop_chance_chaos;
                    var bc = bomb_chance_chaos;
                    var sc = slot_chance_chaos;
                    var cc = chest_chance_chaos;
                }
            
                
                var random_type = irandom_range(1,100);
                if(random_type &lt;= mc){
                    ds_grid_set(map,w,l,2);
                }
                else if(random_type &lt;= mc + cc){
                    ds_grid_set(map,w,l,3);
                }
                else if(random_type &lt;= mc + cc + hc){
                    ds_grid_set(map,w,l,4);
                }
                else if(random_type &lt;= mc + cc + hc + wc){
                    ds_grid_set(map,w,l,6);
                }
                else if(random_type &lt;= mc + cc + hc + wc + bc){
                    ds_grid_set(map,w,l,7);
                }
                else{
                    ds_grid_set(map,w,l,8);
                }
                
                //If this floor is part of the treasury path, insert a chest regardless of the outcome
                if(floor_type[w] == "treasury" and (ds_grid_get(map,w,l) == 2)){ds_grid_set(map,w,l,3);}
                
                //For testing purpouses to force special
                //ds_grid_set(map,w,l,4);
                
                
                w += 1;
            }
            l += 1;
        }
        
        
        var door_1 = irandom_range(3,10);
        var door_2 = irandom_range(11,20);

        var door_4 = irandom_range(3,10);
        var door_5 = irandom_range(11,20);

        var door_7 = irandom_range(3,10);
        var door_8 = irandom_range(11,20);
        
        
        //Set the doors
        ds_grid_set(map,0,door_1,5);
        ds_grid_set(map,0,door_2,5);
        
        ds_grid_set(map,1,door_4,5);
        ds_grid_set(map,1,door_5,5);
        
        ds_grid_set(map,2,door_7,5);
        ds_grid_set(map,2,door_8,5);
        
        
        //Set every one of the end rooms to a boss room
        var w = 0;
        while(w &lt; width){
            ds_grid_set(map,w,length-1,9);
            w += 1;
        }
        
        
        //Check to see if we have an acceptable number of monster encounters on the standard floor
        if(floor_type[0] == "standard"){var stan = 0;}
        else if(floor_type[1] == "standard"){var stan = 1;}
        else if(floor_type[2] == "standard"){var stan = 2;}
        
        //Find the chaos path
        if(floor_type[0] == "chaos"){var chao = 0;}
        else if(floor_type[1] == "chaos"){var chao = 1;}
        else if(floor_type[2] == "chaos"){var chao = 2;}
        
        var cl = 0;
        var encount = 0;
        var healcount = 0;
        var chestcount = 0;
        var shopcount = 0;
        var slotcount = 0;
        var bombcount = 0;
        while(cl &lt; length-1){
            var pp = ds_grid_get(map,stan,cl);
            if(pp == 2){
                encount += 1;
            }
            else if(pp == 3){
                chestcount += 1;
            }
            else if(pp == 4){
                healcount += 1;
            }
            else if(pp == 6){
                shopcount += 1;
            }
            else if(pp == 7){
                bombcount += 1;
            }
            else if(pp == 8){
                slotcount += 1;
            }
            cl += 1;
        }
        
        
        //Pick a random spot for the chaos and standard paths and place a prayer statue
        var found_stan = true;
        var found_chaos = true;
        
        
        //Make sure there is at least 1 monster in the chaos and standard paths
        var fc = 0;
        while(fc &lt; length - 1){
            var cch = ds_grid_get(map,chao,fc);
            if(cch == 2){
                var found_chaos = false;
            }
            fc += 1;
        }
        
        var ssc = 0;
        while(ssc &lt; length - 1){
            var ccs = ds_grid_get(map,stan,ssc);
            if(ccs == 2){
                var found_stan = false;
            }
            ssc += 1;
        }
        
        while(found_stan == false or found_chaos == false){
            if(found_stan == false){
                var stat_loc_s = irandom_range(1,20);
                var check_s = ds_grid_get(map,stan,stat_loc_s);
                if(check_s == 2){
                    found_stan = true;
                    ds_grid_set(map,stan,stat_loc_s,10);
                }
            }
            if(found_chaos == false){
                var stat_loc_c = irandom_range(1,25);  
                var check_c = ds_grid_get(map,chao,stat_loc_c);
                if(check_c == 2){
                    found_chaos = true;
                    ds_grid_set(map,chao,stat_loc_c,10);
                } 
            }
        }
        
        
        if((encount &gt;= 13 and encount &lt;= 18) and (healcount &lt;= 3) and (chestcount &lt;= 9)){
            valid = true;
        }
        else{
            valid = false;
        }
    
    }


}


}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>605</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>0</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>Heal Timer</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{
if(heal_timer &gt;= 0){
    heal_timer += 1;
    if(heal_timer == 10){heal_draw_index = 1;}
    else if(heal_timer == 12){heal_draw_index = 2;}
    else if(heal_timer == 14){heal_draw_index = 3;}
    else if(heal_timer == 16){heal_draw_index = 4;}
    else if(heal_timer == 18){heal_draw_index = 5;}
    else if(heal_timer == 20){heal_draw_index = 6;}
    else if(heal_timer == 22){heal_draw_index = 7;}
    else if(heal_timer == 24){heal_draw_index = 8;}
    else if(heal_timer &gt; 24 and heal_draw_y &lt; 80){heal_draw_y += 5;}
    else if(heal_timer &gt; 24){
        heal_draw_alpha -= 0.05;
        if(heal_timer == 26){heal_draw_index = 7;}
        else if(heal_timer == 28){heal_draw_index = 6;}
        else if(heal_timer == 30){heal_draw_index = 5;}
    }
    if(heal_timer &gt;= 60){
        current_y += 1;
        heal_timer = -1;
        heal_draw_alpha = 1.0;
        heal_draw_index = 0;
        heal_draw_y = 10;
    }
}

}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>605</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>0</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>Check if Dungeon is Completed</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{
//Check if the dungeon is completed
if(game_over == true){
    //Determine the correct ending to be displayed
    globalvar end_text;
    globalvar end_bkgd;
    
    Choose_Ending();
    global.end_bkgd = ending_bkgd_1;
    
    room_goto(Ending_Room);
          
}
}
</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>605</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>0</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>Move on to next room</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{
//Once the battle is over, reset battle variales
if(game_over == false and battling == false and init == false and heal_timer == -1 and in_trap == false and in_shop == false and in_chest == false and in_bomb == false and in_slot == false and in_prayer == false){
    //Regenerate some health for the player
    //if(last_was_trap = false){player_1.HP += 10;}
    //else{last_was_trap = false;}
    //if(player_1.HP &gt; player_1.MAX_HP){player_1.HP = player_1.MAX_HP;}

    if(Dungeon.player_1.attack_type == "physical"){var noff = Dungeon.player_1.strength;}
    else{var noff = Dungeon.player_1.magic;}

    var ndef = Dungeon.player_1.defense;
    var nres = Dungeon.player_1.res;
    var tdeff = round((ndef+nres)/2);
    
    hermit_timer = 0;
    hermit_index = 0;

    Dungeon.player_1.level = round((noff+tdeff)/2);
    
    //Reset timer variables
    timer = 0;
    done_ani = false;    
    spec_alpha = 1;
    spec_x = 128;
    spec_y = -32;
    
    //Decide what the next room holds
    var next_room = ds_grid_get(map,current_x,current_y);
    
    //Make sure the background is correct
    if(floor_type[current_x] == "standard"){
        background_index = 0;
    }
    else if(floor_type[current_x] == "hell"){
        background_index = 2;
    }
    else if(floor_type[current_x] == "chaos"){
        background_index = 3;
    }
    else if(floor_type[current_x] == "treasury"){
        background_index = 1;
    }
    
    //Add floor type to path history
    ds_list_add(path_list,floor_type[current_x]);
    
    
    
    //Starting Room
    if(next_room == 1){
        Text_Box.new_text = "Start!";
        current_y += 1;
    }
       
    //Monster Room
    else if(next_room == 2){
    
    
    //Give the monster a 5% chance of having a holy shield
    var check_shield = irandom_range(1,100);
    if(check_shield &lt;= 5){
        enemy_shield = true;
    }
    else{
        enemy_shield = false;
    }
    
    
    //Get a new enemy from the data grid
    player_2 = instance_create(0,0,Unit);
    
    if(floor_type[current_x] == "chaos"){ 
        var randomonster = Choose_Enemy_Chaos();
    }
    else{
        var randomonster = Choose_Enemy_Standard();
    }
    
    var test_2 = ds_grid_get(monster_data,randomonster,2);
    var test_3 = ds_grid_get(monster_data,randomonster,3);
    var test_4 = ds_grid_get(monster_data,randomonster,4);
    var test_5 = ds_grid_get(monster_data,randomonster,5);
    var test_6 = ds_grid_get(monster_data,randomonster,6);
    var test_7 = ds_grid_get(monster_data,randomonster,7);
    var test_8 = ds_grid_get(monster_data,randomonster,8);
    
    
    player_2.name = ds_grid_get(monster_data,randomonster,0);
    player_2.sprite_index = ds_grid_get(monster_data,randomonster,1);
    
    if(player_2.name == "Avatar"){
        player_2.earth_element = instance_create(130,12,avatar_orbs);
        player_2.earth_element.image_index = 0;
        
        player_2.fire_element = instance_create(130,58,avatar_orbs);
        player_2.fire_element.image_index = 1;
        
        player_2.air_element = instance_create(128+48,58,avatar_orbs);
        player_2.air_element.image_index = 2;
        
        player_2.water_element = instance_create(128+48,12,avatar_orbs);
        player_2.water_element.image_index = 3;
        
        player_2.earth_element.avatar = player_2;
        player_2.water_element.avatar = player_2;
        player_2.air_element.avatar = player_2;
        player_2.fire_element.avatar = player_2;
    }
    
    
    if(player_2.name == "Doppleganger"){
        player_2.MAX_HP = player_1.MAX_HP;
        player_2.strength = player_1.strength;
        player_2.magic = player_1.magic;
        player_2.defense = player_1.defense;
        player_2.res = player_1.res;
        player_2.luck = player_1.luck;
        player_2.HP = player_1.HP;
        player_2.attack_type = player_1.attack_type;
        if(global.player_class == "Rogue"){
            player_2.sprite_index = dopple_rogue_spr;
        }
        else if(global.player_class == "Mage"){
            player_2.sprite_index = dopple_mage_spr;
        }
        else if(global.player_class == "Monk"){
            player_2.sprite_index = dopple_monk_spr;
        }
    }
    
    else{
    
        player_2.MAX_HP = test_2;
        player_2.strength = test_3 - 0;
        player_2.magic = test_4 - 0;
        player_2.defense = test_5 - 0;
        player_2.res = test_6 - 0;
        player_2.luck = test_7 - 0;
        player_2.HP = player_2.MAX_HP;
        player_2.attack_type = ds_grid_get(monster_data,randomonster,8);
    
    }
    
    
    Choose_Index();
    
    
    //Calculate Enemy Level
    if(player_2.attack_type == "physical"){var o = player_2.strength;}
    else{var o = player_2.magic;}
    
    var d = player_2.defense / 2;
    var r = player_2.res / 2;
    
    var td = d + r;
    
    player_2.level = round((o+td)/2);
    
    //Send message to text box
    Text_Box.new_text = player_2.name + " Appears!";
    battling = true;
    battle_phase = "wwww";
    
    //Find the enemy in the Database, and check the seen flag
    var loc = 0;
    while(loc &lt; ds_grid_width(global.enemy_database)){
        if(player_2.name == ds_grid_get(global.enemy_database,loc,1)){
            ds_grid_set(global.enemy_database,loc,0,true);
            break;
        }
        loc += 1;    
    }
    
    
    }
    
    //Chest Room
    else if(next_room == 3){
        spec_enter = true;
        spec_y = -32;
        in_chest = true;
        animate_chest = false;
        is_mimic = false;
        chest_opened = false;
        
        
        //Send message to text box
        Text_Box.new_text = "Found a Chest!";
        battling = false;
        battle_phase = "choose";
        
    }
    
    //Heal room
    else if(next_room == 4){
        player_1.HP = player_1.MAX_HP;
        Text_Box.new_text = "Fully Healed!";
        heal_timer = 0;
    }
    
    //Trap Room
    else if(next_room == 5){
        spec_enter = true;
        spec_y = -32;
        in_trap = true;
        
        //Decide the trap type and level
        var rand_type = irandom_range(1,5);
        //Strength Trap
        if(rand_type == 1){
            trap_type = "STR";
        }
        //Defense Trap
        else if(rand_type == 2){
            trap_type = "DEF";
        }
        //Magic Trap
        else if(rand_type == 3){
            trap_type = "MAG";
        }
        //Res Trap
        else if(rand_type == 4){
            trap_type = "RES";
        }
        //Luck Trap
        else if(rand_type == 5){
            trap_type = "LCK";
        }
        
        trap_level = 10 + current_y;
        
        
        //Determine where the trap leads
        var new_type = irandom_range(1,2);
        
        if(new_type == 1){
            if(floor_type[current_x] == "standard"){trap_door = "treasury";}
            else if(floor_type[current_x] == "treasury"){trap_door = "chaos";}
            else if(floor_type[current_x] == "chaos"){trap_door = "standard";}
        }
        else if(new_type == 2){
            if(floor_type[current_x] == "standard"){trap_door = "chaos";}
            else if(floor_type[current_x] == "treasury"){trap_door = "standard";}
            else if(floor_type[current_x] == "chaos"){trap_door = "treasury";}
        }
        
        if(trap_door == "standard"){trap_index = 0;}
        else if(trap_door == "treasury"){trap_index = 21;}
        else if(trap_door == "chaos"){trap_index = 42;}
        
        
        
        Text_Box.new_text = "You see a door";
    }
    
    //Shop room
    else if(next_room == 6){
        spec_enter = true;
        shop_ball_timer = 0;
        spec_y = -32;
        in_shop = true;
        
        //Decide the shop type and stats
        var randshop = irandom_range(1,2);
        var rands1   = irandom_range(1,4);
        var rands2   = irandom_range(1,4);
        
        //Determine type
        if(randshop == 1){shop_type = "reverse";Text_Box.new_text = "Rev. Hermit Encountered!";Update_Text();}
        else{shop_type = "absorb";Text_Box.new_text = "Abs. Hermit Encountered!";Update_Text();}
        
        //Determine first stat
        if     (rands1 == 1){shop_stat_1 = "STR";}
        else if(rands1 == 2){shop_stat_1 = "MAG";}
        else if(rands1 == 3){shop_stat_1 = "DEF";}
        else if(rands1 == 4){shop_stat_1 = "RES";}
        else if(rands1 == 5){shop_stat_1 = "LCK";}
        
        //Make sure the second stat is not the same as the first
        var different = false;
        while(different == false){
            if(rands2 == rands1){rands2 = irandom_range(1,4);}
            else{different = true;}
        }
        
        //Determine second stat
        if     (rands2 == 1){shop_stat_2 = "STR";}
        else if(rands2 == 2){shop_stat_2 = "MAG";}
        else if(rands2 == 3){shop_stat_2 = "DEF";}
        else if(rands2 == 4){shop_stat_2 = "RES";}
        else if(rands2 == 5){shop_stat_2 = "LCK";}
        
        
    }
    
    //Bomb Room
    else if(next_room == 7){
        spec_enter = true;
        spec_y = -32;
        in_bomb = true;
        //Bomb Data 
        //Level - Number of strikes allowed
        //timer - amount of time until failure ( 10 seconds at start )
        //strikes - amount of current strikes
        //code - 4 digit array containing defusing code
        
        Text_Box.new_text = "A Bomb has been Planted!";
        Update_Text();
        
        //Create the fuse effect
        instance_create(122,76,bomb_flame);
        
        bomb_level = irandom_range(2,2);
        bomb_timer = room_speed * 10;
        bomb_strikes = 0;
        bomb_wait = false;
        bomb_wait_timer = 0;
        bomb_code[0] = irandom_range(0,1);
        bomb_code[1] = irandom_range(0,1);
        bomb_code[2] = irandom_range(0,1);
        bomb_code[3] = irandom_range(0,1);
        bomb_index = 0;
        bomb_entered[0] = false;
        bomb_entered[1] = false;
        bomb_entered[2] = false;
        bomb_entered[3] = false;
        
    }
    
    //Slot Room
    else if(next_room == 8){
        spec_enter = true;
        spec_y = -32;
        in_slot = true;
        
        Text_Box.new_text = "A Slot Machine?";
        Update_Text();
        
        instance_create(128,10,slot_machine);
        
    }
    
    //Prayer Room
    else if(next_room == 10){
        in_prayer = true;
        spec_enter = true;
        spec_y = -32;
        prayer_type = irandom_range(0,2);
        if(prayer_type == 0){var temp_text = "Hermit Shrine";}
        else if(prayer_type == 1){var temp_text = "Bomb Shrine";}
        else{var temp_text = "Slime Shrine";}
        prayer_timer = 0;
        prayed = false;
        
        Text_Box.new_text = "A " + temp_text + " spotted!";
        Update_Text(); 
    }
    
    //Boss Room
    else if(next_room == 9){
    
    
        if(floor_type[current_x] == "chaos"){
        
            player_2 = instance_create(0,0,Unit);
            player_2.sprite_index = lord_of_chaos_spr;
            player_2.name = "Marquis de Chaos";
            player_2.HP = irandom_range(1,70);
            player_2.MAX_HP = player_2.HP;
            player_2.defense = irandom_range(1,70);
            player_2.res = irandom_range(1,70);
            player_2.strength = irandom_range(1,70);
            player_2.magic = irandom_range(1,70);
            player_2.luck = irandom_range(1,70);
            
            
            enemy_level = 0;
            
            //Run chance for a magic type boss
            var is_magic = irandom_range(1,2);
            if(is_magic == 1){
                player_2.attack_type = "magic";
            }
    
            //Change music
            audio_stop_sound(theme_music);
            audio_sound_gain(marquis_theme,global.volume,0);
            theme_music = marquis_theme;
            audio_play_sound(theme_music,1,true);
           
            //Send message to text box
            Text_Box.new_text = "Marquis of Chaos Appears!";
            battling = true;
            battle_phase = "choose";
        
        }
        
        else if(floor_type[current_x] == "treasury"){
        
            player_2 = instance_create(0,0,Unit);
            player_2.sprite_index = dark_merchant_spr;
            player_2.name = "Throne of Avarice";
            player_2.HP = 10;
            player_2.MAX_HP = 10;
            player_2.defense = 1 + (1 * chests_opened);
            player_2.res = 1 + (1 * chests_opened);
            player_2.strength = 1 + (1 * chests_opened);
            player_2.magic = 1 + (1 * chests_opened);
            player_2.luck = 1 + (1 * chests_opened);
            
            
            enemy_level = 1+chests_opened;
            player_2.attack_type = "magic";
    
            //Change music
            audio_stop_sound(theme_music);
            audio_sound_gain(avarice_theme,global.volume,0);
            theme_music = avarice_theme;
            audio_play_sound(theme_music,1,true);
           
            //Send message to text box
            Text_Box.new_text = "Found the Throne of Avarice!";
            battling = true;
            battle_phase = "choose";
        }
        
        else{
    
            player_2 = instance_create(0,0,Unit);
            player_2.sprite_index = dark_lord_spr;
            player_2.name = "Dark Lord";
            player_2.HP = 10;
            player_2.MAX_HP = 20;
            player_2.defense = 55;
            player_2.res = 55;
            player_2.strength = 55;
            player_2.magic = 55;
            player_2.luck = 10;
        
        
            //Run chance for a magic type boss
            var is_magic = irandom_range(1,2);
            if(is_magic == 1){
                player_2.sprite_index = dark_lord_magic_spr;
                player_2.attack_type = "magic";
            }
        
            //Change music
            audio_stop_sound(theme_music);
            audio_sound_gain(boss_song,global.volume,0);
            theme_music = boss_song;
            audio_play_sound(theme_music,1,true);
           
            //Send message to text box
            Text_Box.new_text = "Dark Lord Encountered!";
            battling = true;
            battle_phase = "wwww";
            
            enemy_level = 55;
        
        }
        
        Choose_Index();
        
        
        
        
        //player_2.sprite_index = test_boss_spr;
        
        var loc = 0;
        while(loc &lt; ds_grid_width(global.enemy_database)){
        if(player_2.sprite_index == ds_grid_get(global.enemy_database,loc,2)){
            ds_grid_set(global.enemy_database,loc,0,true);
            break;
        }
        loc += 1;    
    }
        
    }
    
    
}

}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>601</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>1</exetype>
        <functionname>action_execute_script</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>9</kind>
            <script>Battle</script>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>601</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>1</exetype>
        <functionname>action_execute_script</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>9</kind>
            <script>Open_Chest</script>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>601</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>1</exetype>
        <functionname>action_execute_script</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>9</kind>
            <script>Flee_Special</script>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>601</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>1</exetype>
        <functionname>action_execute_script</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>9</kind>
            <script>Bomb</script>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>601</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>1</exetype>
        <functionname>action_execute_script</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>9</kind>
            <script>Prayer</script>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
          <argument>
            <kind>0</kind>
            <string></string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{
if(!audio_is_playing(theme_music)){
    audio_sound_gain(theme_music,global.volume/2.0,0);
    audio_play_sound(theme_music,1,true);
    audio_master_gain(global.volume/2.0);
    if(Dungeon.theme_music == dungeon_theme){
                audio_sound_gain(dungeon_theme,global.volume/3.0,0);
    }
}
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="5" enumb="40">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{
draw_test_y += 5;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="5" enumb="38">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{
draw_test_y -= 5;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="7" enumb="5">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{
audio_stop_all();

//Destroy Data Structures
ds_list_destroy(path_list);
ds_list_destroy(foe_history);
ds_list_destroy(result_history);


ds_grid_destroy(monster_data);
ds_grid_destroy(map);


}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>524</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>1</exetype>
        <functionname>action_color</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>13</kind>
            <string>16777215</string>
          </argument>
        </arguments>
      </action>
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{
if(draw_test == true){
draw_x = 0;
draw_y = 0;

    while(draw_y &lt; length){
        while(draw_x &lt; width){
            var value = ds_grid_get(map,draw_x,draw_y);
            draw_sprite(test_rooms_spr,value,draw_x*8,draw_y*8+draw_test_y);
            draw_x += 1;
        }
        draw_x = 0;
        draw_y += 1;    
    }

    //Draw Current location
    //draw_sprite(test_current_loc_spr,0,current_x*8,current_y*8);


}

else{

    //Draw background transition
    if(instance_exists(background_transition)){
        var spr = background_transition.sprite_index;
        var alp = background_transition.alpha;
        draw_sprite_ext(spr,0,0,0,1,1,0,c_white,alp);
    }

    //Draw Enemy
    if(battling == true){
        draw_sprite_ext(player_2.sprite_index,player_2.image_index,player_2.cur_x,player_2.cur_y,player_2.scale,player_2.scale,0,player_2.color,player_2.alpha);
    }
    
    
    //Draw Traps
    if(in_trap == true){
    
        draw_sprite_ext(current_trap_spr,trap_index,spec_x,spec_y,spec_scale,spec_scale,0,c_white,spec_alpha);
        
    }
    
    
    
    //Calculate the current percentage of the meter
    var total = player_1.meter_max*1.0;
    var current = player_1.meter*1.0;
    
    var ratio = current / total;
    
    if(ratio &lt; 0.1){var percent = 0;}
    else if(ratio &lt; 0.2){var percent = 1;}
    else if(ratio &lt; 0.3){var percent = 2;} 
    else if(ratio &lt; 0.4){var percent = 3;}
    else if(ratio &lt; 0.5){var percent = 4;}
    else if(ratio &lt; 0.6){var percent = 5;}
    else if(ratio &lt; 0.7){var percent = 6;} 
    else if(ratio &lt; 0.8){var percent = 7;}
    else if(ratio &lt; 0.9){var percent = 8;}
    else if(ratio &lt; 1.0){var percent = 9;}
    else{var percent = 10;}
    
    draw_set_font(hp_font);
    draw_sprite_ext(Special_Box.sprite_index,percent,120,134+Special_Box.selected,1,1,0,c_white,1.0);
    if(player_1.HP &gt; 9){draw_text_colour(135,141+Special_Box.selected,"HP:" + string(player_1.HP) + "/" + string(player_1.MAX_HP),c_white,c_white,c_white,c_white,1.0);}
    else{draw_text_colour(135,141+Special_Box.selected,"HP:" + " " + string(player_1.HP) + "/" + string(player_1.MAX_HP),c_white,c_white,c_white,c_white,1.0);}    
    draw_sprite_ext(player_1.sprite_index,player_1.image_index,player_1.cur_x,82,1,1,0,player_1.color,player_1.alpha);
    
    
    //Draw heal zone
    if(heal_timer &gt;= 0){
        draw_sprite_ext(heal_zone_spr,heal_draw_index,129,heal_draw_y,1,1,0,c_white,heal_draw_alpha);
    }
    
    //Write location
    if(global.show_floor == true){
    if(current_x == 0){draw_text(2,2,("Floor:" + string(current_y) + "-" + "A"));}
        else if(current_x == 1){draw_text(2,2,("Floor:" + string(current_y) + "-" + "B"));}
        else if(current_x == 2){draw_text(2,2,("Floor:" + string(current_y) + "-" + "C"));}
        else if(current_x == 3){draw_text(2,2,("Floor:" + string(current_y) + "-" + "D"));}
        else if(current_x == 4){draw_text(2,2,("Floor:" + string(current_y) + "-" + "E"));}
        else if(current_x == 5){draw_text(2,2,("Floor:" + string(current_y) + "-" + "F"));}
        else if(current_x == 6){draw_text(2,2,("Floor:" + string(current_y) + "-" + "G"));}
        else if(current_x == 7){draw_text(2,2,("Floor:" + string(current_y) + "-" + "H"));}
        else if(current_x == 8){draw_text(2,2,("Floor:" + string(current_y) + "-" + "I"));}
        else if(current_x == 9){draw_text(2,2,("Floor:" + string(current_y) + "-" + "J"));}
        else if(current_x == 10){draw_text(2,2,("Floor:" + string(current_y) + "-" + "K"));}
        else if(current_x == 11){draw_text(2,2,("Floor:" + string(current_y) + "-" + "L"));}
        else if(current_x == 12){draw_text(2,2,("Floor:" + string(current_y) + "-" + "M"));}
        else if(current_x == 13){draw_text(2,2,("Floor:" + string(current_y) + "-" + "N"));}
        else if(current_x == 14){draw_text(2,2,("Floor:" + string(current_y) + "-" + "O"));}
        else if(current_x == 15){draw_text(2,2,("Floor:" + string(current_y) + "-" + "P"));}
        else if(current_x == 16){draw_text(2,2,("Floor:" + string(current_y) + "-" + "Q"));}
        else if(current_x == 17){draw_text(2,2,("Floor:" + string(current_y) + "-" + "R"));}
        else if(current_x == 18){draw_text(2,2,("Floor:" + string(current_y) + "-" + "S"));}
        else if(current_x == 19){draw_text(2,2,("Floor:" + string(current_y) + "-" + "T"));}
        else if(current_x == 20){draw_text(2,2,("Floor:" + string(current_y) + "-" + "U"));}
        else if(current_x == 21){draw_text(2,2,("Floor:" + string(current_y) + "-" + "V"));}
        else if(current_x == 22){draw_text(2,2,("Floor:" + string(current_y) + "-" + "W"));}
        else if(current_x == 23){draw_text(2,2,("Floor:" + string(current_y) + "-" + "X"));}
        else if(current_x == 24){draw_text(2,2,("Floor:" + string(current_y) + "-" + "Y"));}
        else if(current_x == 25){draw_text(2,2,("Floor:" + string(current_y) + "-" + "Z"));}
    }
    
    //Calculate and write current player level
    
    if(global.level_display == 1 or global.level_display == 3){
        draw_text(2,12,"Lvl: " + string(player_1.level));
    }
    
    
    if(battling == true and (global.level_display == 2 or global.level_display == 3)){
        draw_text(2,22,"Enemy Lvl: " + string(player_2.level));
    }
    
    
    if(battling == true and player_2.enter == false and has_scouter){
            if(player_2.attack_type == "physical"){
                var offe = player_2.strength;
                var deffe = player_1.defense;
            }
            else{
                var offe = player_2.magic;
                var deffe = player_1.res;   
            }
            if(player_1.attack_type == "physical"){
                var offp = player_1.strength;
                var deffp = player_2.defense;
            }
            else{
                var offp = player_1.magic;
                var deffp = player_2.res;   
            }
            if(deffe &gt; offe + 35){var dame = 0;}
            else if(deffe &gt;= offe){var dame = 1;}
            else{var dame = 1+ offe - deffe;}
            
            if(deffp &gt;= offp){var damp = 1;}
            else{var damp = 1+offp - deffp;}
            
            
            draw_set_color(c_aqua);
            
            draw_text_colour(110,20,"- "+string(damp),c_aqua,c_aqua,c_aqua,c_aqua,0.85);
            draw_text_colour(110,115,"- "+string(dame),c_aqua,c_aqua,c_aqua,c_aqua,0.85);

            
    }
    
    
    
    
    
    //Draw Shop
    if(in_shop == true){
        if(shop_type == "reverse")    {draw_sprite_ext(reverse_wizard_spr,hermit_index,spec_x,spec_y,spec_scale,spec_scale,0,c_white,spec_alpha);}
        else if(shop_type == "absorb"){draw_sprite_ext(absorb_wizard_spr,hermit_index,spec_x,spec_y,spec_scale,spec_scale,0,c_white,spec_alpha);}
        //Draw Stat Icons
        if     (shop_stat_1 == "STR"){draw_sprite_ext(shop_icon_spr,0,spec_x+s1x,spec_y+s1y,spec_scale,spec_scale,0,c_white,spec_alpha);}
        else if(shop_stat_1 == "MAG"){draw_sprite_ext(shop_icon_spr,1,spec_x+s1x,spec_y+s1y,spec_scale,spec_scale,0,c_white,spec_alpha);}
        else if(shop_stat_1 == "DEF"){draw_sprite_ext(shop_icon_spr,2,spec_x+s1x,spec_y+s1y,spec_scale,spec_scale,0,c_white,spec_alpha);}
        else if(shop_stat_1 == "RES"){draw_sprite_ext(shop_icon_spr,3,spec_x+s1x,spec_y+s1y,spec_scale,spec_scale,0,c_white,spec_alpha);}
        else if(shop_stat_1 == "LCK"){draw_sprite_ext(shop_icon_spr,4,spec_x+s1x,spec_y+s1y,spec_scale,spec_scale,0,c_white,spec_alpha);}
        
        if     (shop_stat_2 == "STR"){draw_sprite_ext(shop_icon_spr,0,spec_x+s2x,spec_y+s2y,spec_scale,spec_scale,0,c_white,spec_alpha);}
        else if(shop_stat_2 == "MAG"){draw_sprite_ext(shop_icon_spr,1,spec_x+s2x,spec_y+s2y,spec_scale,spec_scale,0,c_white,spec_alpha);}
        else if(shop_stat_2 == "DEF"){draw_sprite_ext(shop_icon_spr,2,spec_x+s2x,spec_y+s2y,spec_scale,spec_scale,0,c_white,spec_alpha);}
        else if(shop_stat_2 == "RES"){draw_sprite_ext(shop_icon_spr,3,spec_x+s2x,spec_y+s2y,spec_scale,spec_scale,0,c_white,spec_alpha);}
        else if(shop_stat_2 == "LCK"){draw_sprite_ext(shop_icon_spr,4,spec_x+s2x,spec_y+s2y,spec_scale,spec_scale,0,c_white,spec_alpha);}
        
    }
    
    //Draw Chest
    if(in_chest == true){
        draw_sprite_ext(chest_1_spr,chest_index,spec_x,spec_y,spec_scale,spec_scale,0,c_white,spec_alpha);
    }
    
    //Draw Prayer Statue
    if(in_prayer == true){
        draw_sprite_ext(prayer_statue_spr,prayer_type,spec_x,spec_y,spec_scale,spec_scale,0,c_white,spec_alpha);
    }
    
    //Draw Bomb
    if(in_bomb == true){
        //draw_text(150,80,string(bomb_strikes)+" / " + string(bomb_level+1));
        //draw_text(128,80,string(bomb_timer));
        draw_sprite_ext(bomb_spr,bomb_index,spec_x,spec_y,1,1,0,c_white,spec_alpha);
        
        if(bomb_index &lt; 10){
        
        if(bomb_wait == true){
            draw_sprite_ext(bomb_mark_spr,1,spec_x+22,spec_y+45,1,1,0,c_white,spec_alpha);
            draw_sprite_ext(bomb_mark_spr,1,spec_x+30,spec_y+45,1,1,0,c_white,spec_alpha);
            draw_sprite_ext(bomb_mark_spr,1,spec_x+38,spec_y+45,1,1,0,c_white,spec_alpha);
            draw_sprite_ext(bomb_mark_spr,1,spec_x+46,spec_y+45,1,1,0,c_white,spec_alpha);
        }
        
        else{
            var dbi = 0;
            while(dbi &lt; 4){
                if(bomb_entered[dbi] == true){draw_sprite_ext(bomb_mark_spr,0,spec_x+22+(8*dbi),spec_y+45,1,1,0,c_white,spec_alpha)}
                dbi += 1;
            }
        }
        
        }    
    }
    
}






}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="9" enumb="82">
      <action>
        <libid>1</libid>
        <id>331</id>
        <kind>0</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>0</useapplyto>
        <exetype>1</exetype>
        <functionname>action_restart_game</functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
      </action>
    </event>
    <event eventtype="9" enumb="68">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{
if(draw_test == true){draw_test = false;}
else{draw_test = true;}
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="9" enumb="40">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>{
player_1.HP -= 1;
}
</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
